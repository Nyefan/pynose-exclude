name: "Release to PyPI"
on:
  workflow_dispatch:

jobs:
  pypi-publish:
    name: "Release to PyPI"
    runs-on: "ubuntu-latest"
    environment:
      name: "pynose-exclude-release"
      url: "https://pypi.org/p/pynose-exclude"
    permissions:
      id-token: "write"
    steps:
      - uses: "actions/checkout@v4"
      - name: "Set up Python 3.12"
        uses: "actions/setup-python@v5"
        with:
          python-version: "3.12"
      - name: "Install dependencies"
        run: |
          python -m pip install --upgrade pip setuptools tox
      - name: "Build, lint, and test"
        run: |
          tox -e release
      - name: "Publish to PyPI"
        uses: "pypa/gh-action-pypi-publish@release/v1"
        with:
          packages-dir: ".tox/.pkg/dist"